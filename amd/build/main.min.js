/*
  tim st.clair <https://github.com/frumbert>
 @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
*/
define(["jquery","core/templates","core/notification"],function(f,k,l){var h={init:function(c){c.on("submit",h.submit);h.listen(c);h.create(c)},listen:function(c){c.focusin(function(d){var b=f(d.target).closest("tr");d=b.closest("tbody");var a=d.children("tr").length,g=b.index(),e=!1;f("input",b).each(function(){e=this.value.trim().length||e});g===a-1&&e&&(b=b.clone(!0),d.append(b),b.find("input").each(function(){this.value=""}),f("button",c).removeAttr("disabled"))})},create:function(c){f("button",
c).addClass("btn-primary")},notify:function(c,d,b){k.render("block_createusers/feedback",{message:b,type:d}).then(function(a,g){k.appendNodeContents(f(".block-createusers-feedback",c)[0],a,g)}).fail(l.exception)},submit:function(c){var d=f(c.target);f.post(d.attr("action"),d.serialize()).done(function(b){d.trigger("reset");f("tbody>tr",d).slice(1).remove();[].forEach.call(b,function(a){if(""!==a.email){var g=1>a.code?"warning":"success",e=a.email;-3===a.code?e+=" already exists":-4===a.code||-5===
a.code?e+=" skipped (firstname or lastame not included)":-2===a.code?e+=" was not considered valid by Moodle":1===a.code?e+=" was created":2===a.code?e+=" was created and notified":(e="Response was not understood: "+JSON.stringify(a),g="danger");h.notify(d,g,e)}})}).fail(function(b){console.warn(b)});return!1}};return h});